sap.ui.define(["sap/ui/core/Control","sap/m/Input","sap/m/InputBase","sap/m/Label","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/SelectDialog"],function(e,t,i,l,a,s,n){"use strict";return t.extend("zsandiego.Crear_Peticion_Oferta.control.InputValueHelp",{metadata:{properties:{value:{type:"string",defaultValue:""},text:{type:"string",defaultValue:""},showValueHelp:{type:"boolean",defaultValue:true},helpModel:{type:"string",defaultValue:""},helpEntitySet:{type:"string",defaultValue:""},helpDescriptionField:{type:"string",defaultValue:""},helpKeyField:{type:"string",defaultValue:""},helpText:{type:"string",defaultValue:""},dialogTitle:{type:"string",defaultValue:""}},aggregations:{_label:{type:"sap.m.Label",multiple:false,visibility:"hidden"},_dialog:{type:"sap.m.SelectDialog",multiple:false,visibility:"hidden"}},events:{helpSelect:{allowPreventDefault:false,parameters:{selectedItem:{type:"object"}}},afterChange:{allowPreventDefault:false},beforeHelpRequest:{allowPreventDefault:false}},renderer:null},beforeFilter:null,init:function(){this._cache={};t.prototype.init.call(this);this.attachLiveChange(this.onLiveChange);this.attachChange(this.onChange);this.addStyleClass("inputValueHelp");this.addStyleClass("containerValueHelp");this.setAggregation("_label",new l({text:""}).addStyleClass("sapUiTinyMargin labelValueHelp"));var e=this;this.setAggregation("_dialog",new n({title:e.getDialogTitle(),confirm:function(t){var i=t.getParameter("selectedItem");e.setHelpText(i.getDescription());e.setValue(i.getTitle());e._cache[i.getTitle()]=i.getDescription();e.fireEvent("helpSelect",{selectedItem:i});e.fireEvent("afterChange",{})},cancel:function(e){},search:function(t){var i=t.getParameter("value");if(!i||i===""){this.getBinding("items").filter([])}else{var l=[];l.push(new a(e.getHelpKeyField(),s.Contains,i));if(e.getHelpDescriptionField()!==""){l.push(new a(e.getHelpDescriptionField(),s.Contains,i))}var n=new a({filters:l,and:false});this.getBinding("items").filter(n)}}}));this.attachSuggest(this.onSuggest);this.attachSuggestionItemSelected(this.onSuggestionItemSelected)},attachBeforeFilter:function(e){this.beforeFilter=e},onSuggestionItemSelected:function(e){var t=e.getParameter("selectedItem");this.setValue(t.getText());this.fireEvent("afterChange",{})},onLiveChange:function(e){if(e.getParameter("newValue")===""){this.setValueState("None");this.setHelpText("");this.getBinding("value").setValue("")}},setHelpText:function(e){this.getAggregation("_label").setText(e);this.setText(e)},getHelpText:function(e){return this.getAggregation("_label").getText()},renderer:function(e,t){e.write("<div style='width:"+t.getWidth()+"'");e.writeControlData(t);e.writeClasses();e.write(">");sap.m.InputRenderer.render(e,t);e.renderControl(t.getAggregation("_label"));e.write("</div>")},onModelPropertyChange:function(e){if(e.getParameter("path")==="/"+this.getHelpEntitySet()){this.onChange({sId:"propertyChange"})}},onAfterRendering:function(){if(this.loaded){return}this.loaded=true;if(sap.ui.core.Control.prototype.onAfterRendering){sap.ui.core.Control.prototype.onAfterRendering.apply(this,arguments);this.onChange({sId:"afterRendering"});var e=this.getModel(this.getHelpModel());e.attachPropertyChange(this.onModelPropertyChange,this);var t=this.getBinding("value");if(t){t.attachChange(this.onChange,this)}var i=this.getHelpModel()+">/"+this.getHelpEntitySet();this.bindAggregation("suggestionItems",{path:i,template:new sap.ui.core.ListItem({text:"{"+this.getHelpModel()+">"+this.getHelpKeyField()+"}",additionalText:this.getHelpDescriptionField()!==""?"{"+this.getHelpModel()+">"+this.getHelpDescriptionField()+"}":""})});if(!this.hasListeners("valueHelpRequest")){this.attachValueHelpRequest(this.onValueHelpRequest)}}},onSuggest:function(e){var t=e.getSource();var i=t.getBindingInfo("suggestionItems").template;var l=[];var n=e.getParameter("suggestValue");if(n){l.push(new a(i.getBindingPath("text"),s.Contains,n));if(i.getBindingPath("additionalText")){l.push(new a(i.getBindingPath("additionalText"),s.Contains,n))}}e.getSource().getBinding("suggestionItems").filter(new a({filters:l,and:false}));e.getSource().setFilterSuggests(false)},onChange:function(e){if(e&&e.type){this.getBinding("value").setValue(this.getValue())}if(sap.ui.core.Control.prototype.onChange){sap.ui.core.Control.prototype.onChange.apply(this,arguments)}console.log(e);var t=this.getValue();if(t===""){this.setValueState("None");this.setHelpText("");this.getBinding("value").setValue("")}else{if(this._cache[t]){this.setValueState("None");this.setHelpText(this._cache[t])}else{var i=this;var l=this.getModel(this.getHelpModel());if(!l.sServiceUrl){var s=l.oData[this.getHelpEntitySet()];if(s){var n=s.find(e=>e[this.getHelpKeyField()]==t);if(n){i.setValueState("None");i.setHelpText(n[i.getHelpDescriptionField()])}else{i.setValueState("Error");i.setHelpText("");setTimeout(function(){i.getBinding("value").setValue("");i.setValue("")})}i._cache[t]=i.getHelpText()}}else{this.getAggregation("_label").setBusy(true);var r=new a(this.getHelpKeyField(),"EQ",t);l.read("/"+this.getHelpEntitySet(),{filters:[r],success:function(e){i.getAggregation("_label").setBusy(false);if(e.results.length!==0){i.setValueState("None");i.setHelpText(e.results[0][i.getHelpDescriptionField()])}else{i.setValueState("Error");i.setHelpText("");setTimeout(function(){i.getBinding("value").setValue("");i.setValue("")})}},error:function(e){i.getAggregation("_label").setBusy(false);i.setHelpText("");i.setValueState("Error");setTimeout(function(){i.getBinding("value").setValue("");i.setValue("")})}})}}}},openValueHelp:function(){if(this.beforeFilter){this.beforeFilter()}else{this.aFilters=[]}var e=this.getAggregation("_dialog");if(this._dialogLoaded){e.getBinding("items").filter(this.aFilters)}else{var t=new sap.m.StandardListItem("DialogItems"+this.getId(),{title:"{"+this.getHelpKeyField()+"}",description:this.getHelpDescriptionField()!==""?"{"+this.getHelpDescriptionField()+"} ":""});e.setTitle(this.getDialogTitle());e.setModel(this.getModel(this.getHelpModel()));e.bindAggregation("items",{path:"/"+this.getHelpEntitySet(),filters:this.aFilters,template:t});this._dialogLoaded=true}e.open()},onValueHelpRequest:function(e){this.openValueHelp()},onSelect:function(e){}})});