sap.ui.define(["./BaseController","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/core/Fragment","sap/m/MessageBox","../service/serviceSL"],function(e,t,o,r,a,n,s,i){"use strict";return e.extend("zsandiego.crearreserva.controller.Home",{formatter:t,onInit:function(){var e=this.getOwnerComponent();this._router=e.getRouter();this._router.getRoute("categories").attachMatched(this._onRouteMatched,this);this._catalogo=this.getOwnerComponent().getModel("catalogo");this.localmodel=this.getOwnerComponent().getModel("localmodel");var t=this;var a=new o("Status",r.EQ,"A");this.byId("categoryList").setBusy(true);this.onGetItemServiceLayer();this.consultaEmpleados();var n="zsandiego.crearreserva";this.localmodel.setProperty("/localmodel/lineafragmento",{});this.localmodel.setProperty("/CentrosCosto",[]);this.localmodel.setProperty("/placeholder",jQuery.sap.getModulePath(n)+"/img/11030-200.png")},onBeforeRendering:function(){},getWFInstances:function(){var e=this;var t=e.getOwnerComponent().getManifestObject();var o=this.getOwnerComponent().getManifestEntry("/sap.app/id");var r=o.replaceAll(".","/");var a=jQuery.sap.getModulePath(r);var n=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this.getView()))._oManifest._oBaseUri._parts.path;return new Promise(function(e,t){$.ajax({url:a+"/wfrest/v1/workflow-instances",method:"GET",async:false,headers:{"X-CSRF-Token":"Fetch"},success:function(t,o,r){e(t)}})})},onGetItemServiceLayer:function(e){var t=this;let o=this.getOwnerComponent().getManifestObject();var r={USRWS:"S4ND!3G0",PWDWS:"1NG.S4ND13G0",CompanyDB:"TEST_QA_102022",Password:"integra",UserName:"manager",Server:"172.31.49.151",ItemCode:"0026592"};var a=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this.getView()))._oManifest._oBaseUri._parts.path;return new Promise(function(o,r){var n=null;if(e){n=a+"sb1sl/Items?$filter=contains(ItemName,'"+e+"')"}else{n=a+"sb1sl/Items?$skip=50000"}$.ajax({type:"GET",dataType:"json",url:n,success:function(r){if(!e||e){for(let e=0;e<r.value.length;e++){let t=r.value[e].ItemWarehouseInfoCollection;t.forEach(function(e){e.InStock2=e.InStock})}t.localmodel.setProperty("/catalogosSet",r.value)}else{r.ItemWarehouseInfoCollection.forEach(function(e){e.InStock2=e.InStock});t.localmodel.setProperty("/catalogosSet",[]);t.localmodel.getProperty("/catalogosSet").push(r)}t.byId("categoryList").setBusy(false);o(r.value)},error:function(e){r(e.responseJSON)}})})},consultaEmpleados:function(){var e=this;var t=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this.getView()))._oManifest._oBaseUri._parts.path;return new Promise(function(o,r){var a=t+"sb1sl/EmployeesInfo";$.ajax({type:"GET",dataType:"json",url:a,success:function(t){e.localmodel.setProperty("/empleados",t.value);o(t.value)},error:function(e){r(e.responseJSON)}})})},onCentrosDeCosto:function(){var e=this;var t=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this.getView()))._oManifest._oBaseUri._parts.path;return new Promise(function(o,r){var a=t+"sb1sl/ProfitCenters";$.ajax({type:"GET",dataType:"json",url:a,success:function(t){e.localmodel.setProperty("/CentrosCosto",t.value);o(t.value)},error:function(e){r(e.responseJSON)}})})},onAfterRendering:function(){var e="zsandiego.crearreserva"},_onRouteMatched:function(){var e=this.getModel("appView").getProperty("/smallScreenMode");if(e){this._setLayout("One")}},onSearch:function(){this._search()},onRefresh:function(){var e=this;var t=new o("Status",r.EQ,"A");this.byId("categoryList").setBusy(true);this.onGetItemServiceLayer();var a=e.byId("categoryList");var n=a.getBinding("items");n.filter(null);this.byId("searchField").setValue()},onBuscar:async function(e){var t=e.getSource().getValue();if(t){await this.onGetItemServiceLayer(t)}else{await this.onGetItemServiceLayer()}this.localmodel.refresh(true)},_search:function(){var e=this.getView();var t=e.byId("categoryList");var a=[];var n=this.byId("searchField").getValue();if(n&&n.length>0){a.push(new o("Catnr",r.Contains,n.toUpperCase()));a.push(new o("Caktx",r.Contains,n.toUpperCase()))}var s=this.byId("categoryList");var i=s.getBinding("items");i.filter(new o({filters:a,and:false}));i.refresh()},onCategoryListItemPress:async function(e){var t=e.getParameter("listItem");var o=t.getBindingContext("localmodel").getObject();var r=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this.getView()))._oManifest._oBaseUri._parts.path;for(let e=0;e<o.ItemWarehouseInfoCollection.length;e++){var a=o.ItemWarehouseInfoCollection[e];if(a.InStock>0){var n=await i.onObtenerDescuentoReserva(r,a);n.length>0?a.InStock=a.InStock2-n[0].U_CantReserva:null}}var s=o.ItemCode;this._router.navTo("category",{id:s});this._unhideMiddlePage()},onProductListSelect:function(e){var t=e.getParameter("listItem");this._showProduct(t)},onProductListItemPress:function(e){var t=e.getSource();this._showProduct(t)},_showProduct:function(e){var t=e.getBindingContext().getObject();this._router.navTo("product",{id:t.Category,productId:t.ProductId},!a.system.phone)},onBack:function(){this.getRouter().navTo("home")}})});