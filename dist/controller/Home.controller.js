sap.ui.define(["./BaseController","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/core/Fragment","sap/m/MessageBox"],function(e,t,o,r,s,a,n){"use strict";return e.extend("zsandiego.carritocompras.controller.Home",{formatter:t,onInit:function(){var e=this.getOwnerComponent();this._router=e.getRouter();this._router.getRoute("categories").attachMatched(this._onRouteMatched,this);this._catalogo=this.getOwnerComponent().getModel("catalogo");this.localmodel=this.getOwnerComponent().getModel("localmodel");this.getWFInstances();var t=this;var s=new o("Status",r.EQ,"A");this.byId("categoryList").setBusy(true);this.onGetItemServiceLayer();this.consultaEmpleados();var a="zsandiego.carritocompras";this.localmodel.setProperty("/localmodel/lineafragmento",{});this.localmodel.setProperty("/CentrosCosto",[]);this.localmodel.setProperty("/placeholder",jQuery.sap.getModulePath(a)+"/img/11030-200.png")},onBeforeRendering:function(){},getWFInstances:function(){var e=this;var t=e.getOwnerComponent().getManifestObject();var o=this.getOwnerComponent().getManifestEntry("/sap.app/id");var r=o.replaceAll(".","/");var s=jQuery.sap.getModulePath(r);var a=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this.getView()))._oManifest._oBaseUri._parts.path;return new Promise(function(e,t){$.ajax({url:s+"/wfrest/v1/workflow-instances",method:"GET",async:false,headers:{"X-CSRF-Token":"Fetch"},success:function(t,o,r){e(t)}})})},onGetItemServiceLayer:function(){var e=this;let t=this.getOwnerComponent().getManifestObject();var o={USRWS:"S4ND!3G0",PWDWS:"1NG.S4ND13G0",CompanyDB:"TEST_QA_102022",Password:"integra",UserName:"manager",Server:"172.31.49.151",ItemCode:"0026592"};var r=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this.getView()))._oManifest._oBaseUri._parts.path;return new Promise(function(t,o){var s=r+"sb1sl/Items?$skip=50000";$.ajax({type:"GET",dataType:"json",url:s,success:function(o){e.localmodel.setProperty("/catalogosSet",o.value);e.byId("categoryList").setBusy(false);t(o.value)},error:function(e){o(e.responseJSON)}})})},consultaEmpleados:function(){var e=this;var t=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this.getView()))._oManifest._oBaseUri._parts.path;return new Promise(function(o,r){var s=t+"sb1sl/EmployeesInfo";$.ajax({type:"GET",dataType:"json",url:s,success:function(t){e.localmodel.setProperty("/empleados",t.value);o(t.value)},error:function(e){r(e.responseJSON)}})})},onCentrosDeCosto:function(){var e=this;var t=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this.getView()))._oManifest._oBaseUri._parts.path;return new Promise(function(o,r){var s=t+"sb1sl/ProfitCenters";$.ajax({type:"GET",dataType:"json",url:s,success:function(t){e.localmodel.setProperty("/CentrosCosto",t.value);o(t.value)},error:function(e){r(e.responseJSON)}})})},onAfterRendering:function(){var e="zsandiego.carritocompras";this.getView().byId("imgLogo").setSrc(jQuery.sap.getModulePath(e)+"/img/imageMain.png")},_onRouteMatched:function(){var e=this.getModel("appView").getProperty("/smallScreenMode");if(e){this._setLayout("One")}},onSearch:function(){this._search()},onRefresh:function(){var e=this;var t=new o("Status",r.EQ,"A");this.byId("categoryList").setBusy(true);this.onGetItemServiceLayer();var s=e.byId("categoryList");var a=s.getBinding("items");a.filter(null);this.byId("searchField").setValue()},onBuscar:function(e){var t=[];var s=e.getSource().getValue();if(s&&s.length>0){t.push(new o("ItemCode",r.Contains,s));t.push(new o("ItemName",r.Contains,s))}var a=this.byId("categoryList");var n=a.getBinding("items");if(t.length!==0){n.filter(new o({filters:t,and:false}))}else{n.filter(null)}},_search:function(){var e=this.getView();var t=e.byId("categoryList");var s=[];var a=this.byId("searchField").getValue();if(a&&a.length>0){s.push(new o("Catnr",r.Contains,a.toUpperCase()));s.push(new o("Caktx",r.Contains,a.toUpperCase()))}var n=this.byId("categoryList");var i=n.getBinding("items");i.filter(new o({filters:s,and:false}));i.refresh()},onCategoryListItemPress:function(e){var t=e.getParameter("listItem");var o=t.getBindingContext("localmodel").getObject();var r=o.ItemCode;this._router.navTo("category",{id:r});this._unhideMiddlePage();this.getView().byId("searchField").clear("true")},onProductListSelect:function(e){var t=e.getParameter("listItem");this._showProduct(t)},onProductListItemPress:function(e){var t=e.getSource();this._showProduct(t)},_showProduct:function(e){var t=e.getBindingContext().getObject();this._router.navTo("product",{id:t.Category,productId:t.ProductId},!s.system.phone)},onBack:function(){this.getRouter().navTo("home")}})});