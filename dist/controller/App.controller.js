sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/core/Fragment","sap/m/MessageBox"],function(e,a,t,r,i,s,o){"use strict";return e.extend("zsandiego.crearreserva.controller.App",{onInit:function(){this._oCart=this.getOwnerComponent().getModel("cartProducts");this.localmodel=this.getOwnerComponent().getModel("localmodel");sap.ui.getCore().getMessageManager().removeAllMessages();var e,t,r=this.getView().getBusyIndicatorDelay();e=new a({busy:false,delay:0,layout:i.system.phone?"OneColumn":"TwoColumnsMidExpanded",smallScreenMode:true});this.setModel(e,"appView");this.fnSetAppNotBusy=function(){e.setProperty("/busy",false);e.setProperty("/delay",r)};var s=this;this.localmodel=this.getOwnerComponent().getModel("localmodel");this.matchcode=this.getOwnerComponent().getModel("matchcode");this.matchcode.read("/ZCDSALAYRI_ESART",{success:function(e,a){s.localmodel.setProperty("/ZCDSALAYRI_ESART",a.data.results);s.localmodel.firePropertyChange({reason:sap.ui.model.ChangeReason.Change,path:"/ZCDSALAYRI_ESART"})}});this.matchcode.read("/ZCDSMM_WERKS_TXT",{success:function(e,a){s.localmodel.setProperty("/ZCDSMM_WERKS_TXT",a.data.results);s.localmodel.firePropertyChange({reason:sap.ui.model.ChangeReason.Change,path:"/ZCDSMM_WERKS_TXT"})}});this.matchcode.read("/ZCDSMM_EKORG_TXT",{success:function(e,a){s.localmodel.setProperty("/ZCDSMM_EKORG_TXT",a.data.results);s.localmodel.firePropertyChange({reason:sap.ui.model.ChangeReason.Change,path:"/ZCDSMM_EKORG_TXT"})}});this.matchcode.read("/ZCDSMM_EKGRP_TXT",{success:function(e,a){s.localmodel.setProperty("/ZCDSMM_EKGRP_TXT",a.data.results);s.localmodel.firePropertyChange({reason:sap.ui.model.ChangeReason.Change,path:"/ZCDSMM_EKGRP_TXT"})}});this.matchcode.read("/ZCDSFI_SOCIEDAD_TXT",{success:function(e,a){s.localmodel.setProperty("/ZCDSFI_SOCIEDAD_TXT",a.data.results);s.localmodel.firePropertyChange({reason:sap.ui.model.ChangeReason.Change,path:"/ZCDSFI_SOCIEDAD_TXT"})}});this.matchcode.read("/ZCDSMM_IDNLF_TXT",{success:function(e,a){s.localmodel.setProperty("/ZCDSMM_IDNLF_TXT",a.data.results);s.localmodel.firePropertyChange({reason:sap.ui.model.ChangeReason.Change,path:"/ZCDSMM_IDNLF_TXT"})}});this.getView().addStyleClass(this.getOwnerComponent().getContentDensityClass())},onAfterRendering:function(){},onBeforeRendering:function(){this.cartProducts=this.getOwnerComponent().getModel("cartProducts");const e=this.getOwnerComponent().getEventBus();e.subscribe("app","openDatosCabecera",this.openDatosCabeceraBus,this);this.openDatosCabecera=sap.ui.xmlfragment("zsandiego.crearreserva.view.fragment.DatosCabecera",this);this.getView().addDependent(this.openDatosCabecera);this.openGrupoCompras=sap.ui.xmlfragment("zsandiego.crearreserva.view.fragment.GrupoCompras",this);this.getView().addDependent(this.openGrupoCompras);this.getView().addStyleClass(this.getOwnerComponent().getContentDensityClass())},openDatosCabeceraBus:function(e){this.openDatosCabecera.open()},openFragOrgCompra:function(e){var a=e.getSource().getValue();this.inputId=e.getSource().getId();if(!this._valueOrgx){this._valueOrgx=sap.ui.xmlfragment("zsandiego.crearreserva.view.fragment.OrgCompras",this);this.getView().addDependent(this._valueOrgx)}this._valueOrgx.open()},_handleValueHelpSearchOrg:function(e){var a=e.getParameter("value");var i=new t("ekorg",r.Contains,a);e.getSource().getBinding("items").filter([i])},_handleValueHelpCloseOrg:function(e){var a=e.getParameter("selectedItem");if(a){var t=sap.ui.getCore().byId("idOrganizacionCompra");t.setValue(a.getTitle())}e.getSource().getBinding("items").filter([])},openFragGrupoCompra:function(e){var a=e.getSource().getValue();this.inputId=e.getSource().getId();if(!this._valueCuentax){this._valueCuentax=sap.ui.xmlfragment("zsandiego.crearreserva.view.fragment.GrupoCompras",this);this.getView().addDependent(this._valueCuentax)}this._valueCuentax.open()},_handleValueHelpSearchGrupo:function(e){var a=e.getParameter("value");var i=[];i.push(new t("ekgrp",r.Contains,a));i.push(new t("eknam",r.Contains,a));e.getSource().getBinding("items").filter(new t({filters:i,and:false}))},_handleValueHelpCloseGrupo:function(e){var a=e.getParameter("selectedItem");if(a){var t=sap.ui.getCore().byId("idfragGrupoCompra");t.setValue(a.getTitle())}e.getSource().getBinding("items").filter([])},openFragSociedad:function(e){var a=e.getSource().getValue();this.inputId=e.getSource().getId();if(!this._valueSociedad){this._valueSociedad=sap.ui.xmlfragment("zsandiego.crearreserva.view.fragment.Sociedad",this);this.getView().addDependent(this._valueSociedad)}this._valueSociedad.open()},_handleValueHelpSearchSociedad:function(e){var a=e.getParameter("value");var i=new t("bukrs",r.Contains,a);e.getSource().getBinding("items").filter([i])},_handleValueHelpCloseSociedad:function(e){var a=e.getParameter("selectedItem");if(a){var t=sap.ui.getCore().byId("idfragSociedad");t.setValue(a.getTitle())}e.getSource().getBinding("items").filter([])},openFragAsignacion:function(e){var a=e.getSource().getValue();this.inputId=e.getSource().getId();if(!this._valueHelpDialog){this._valueHelpDialog=sap.ui.xmlfragment("zsandiego.crearreserva.view.fragment.asignacion",this);this.getView().addDependent(this._valueHelpDialog)}this._valueHelpDialog.open()},_handleValueHelpSearchAsignacion:function(e){var a=e.getParameter("value");var i=new t("batxt",r.Contains,a);e.getSource().getBinding("items").filter([i])},_handleValueHelpCloseAsignacion:function(e){var a=e.getParameter("selectedItem");if(a){var t=sap.ui.getCore().byId("idfragasignacion");t.setValue(a.getTitle())}e.getSource().getBinding("items").filter([]);sap.ui.getCore().byId(this.inputId)._bSelectingItem=true;sap.ui.getCore().byId(this.inputId).fireChange()},handleInputChange:function(e){var a=e.getSource();var t=a.getBindingPath("value");var r=a._bSelectingItem;if(r){a.setValueState("None")}else{this._oCart.setProperty(t,"");a.setValueState("Error")}a._bSelectingItem=undefined;if(t==="/lineaCabeceraDetalle/AsignacionDetalle"){var i=this._oCart.getProperty(t);var s=this.getModel("matchcode").getProperty("/ZCDSALAYRI_ESART('"+i+"')/batxt");this.cartProducts.setProperty("/Clasepedido",s)}},onAceptarCabecera:function(){var e=!!this.getView().$().closest(".sapUiSizeCompact").length;var a=sap.ui.getCore().byId("idfragasignacion").getValue();var t=sap.ui.getCore().byId("idOrganizacionCompra").getValue();var r=sap.ui.getCore().byId("idfragGrupoCompra").getValue();var i=sap.ui.getCore().byId("idfragSociedad").getValue();var s=sap.ui.getCore().byId("idfragSolicitante").getValue();if(a.length==0){o.warning("Ingresa una clase de pedido",{styleClass:e?"sapUiSizeCompact":""});return}else if(t.length==0){o.warning("Ingresa una organizaci√≥n de compras",{styleClass:e?"sapUiSizeCompact":""});return}else if(r.length==0){o.warning("Ingresa un grupo de compras",{styleClass:e?"sapUiSizeCompact":""});return}else if(i.length==0){o.warning("Ingresa una sociedad",{styleClass:e?"sapUiSizeCompact":""});return}else if(s.length==0){o.warning("Ingresa un solicitante",{styleClass:e?"sapUiSizeCompact":""});return}this.fnSetAppNotBusy();this.openDatosCabecera.close()},onCloseCabecera:function(){this.fnSetAppNotBusy();this.openDatosCabecera.close()},onCancelarCabecera:function(){sap.ui.getCore().byId("idfragasignacion").setValue();sap.ui.getCore().byId("idOrganizacionCompra").setValue();sap.ui.getCore().byId("idfragGrupoCompra").setValue();sap.ui.getCore().byId("idfragSociedad").setValue();sap.ui.getCore().byId("idfragSolicitante").setValue();this.cartProducts.setProperty("/Clasepedido","");this.fnSetAppNotBusy();this.openDatosCabecera.close()}})});