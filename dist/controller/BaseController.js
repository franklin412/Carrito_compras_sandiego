sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/core/UIComponent","sap/ui/core/routing/History","../model/cart","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","../service/serviceSL"],function(e,t,a,i,n,o,r,s,l){"use strict";var d;var u;return e.extend("zsandiego.crearreserva.controller.BaseController",{cart:n,getRouter:function(){return a.getRouterFor(this)},getModel:function(e){return this.getView().getModel(e)},setModel:function(e,t){return this.getView().setModel(e,t)},getResourceBundle:function(){return this.getOwnerComponent().getModel("i18n").getResourceBundle()},onStateChange:function(e){var t=e.getParameter("layout"),a=e.getParameter("maxColumnsCount");if(a===1){this.getModel("appView").setProperty("/smallScreenMode",true)}else{this.getModel("appView").setProperty("/smallScreenMode",false);if(t==="OneColumn"){this._setLayout("Two")}}},_setLayout:function(e){if(e){this.getModel("appView").setProperty("/layout",e+"Column"+(e==="One"?"":"sMidExpanded"))}},_unhideMiddlePage:function(){setTimeout(function(){this.getOwnerComponent().getRootControl().byId("layout").getCurrentMidColumnPage().removeStyleClass("sapMNavItemHidden")}.bind(this),0)},onBack:function(){this._unhideMiddlePage();var e=i.getInstance();var t=e.getPreviousHash();if(t!==undefined){window.history.go(-1)}else{this.getRouter().navTo("home")}},onAddToCart:function(){var e=this.getView().getModel("localmodel").getProperty("/ProductData");if(!this.oDialogQuantity){this.oDialogQuantity=sap.ui.xmlfragment("zsandiego.crearreserva.view.fragment.addQuantity",this);this.getView().addDependent(this.oDialogQuantity)}sap.ui.getCore().byId("sInpQuantityLabel").setLabel("Cantidad ");sap.ui.getCore().byId("sInpQuantity").setMin(parseFloat(e.Cant_Min));sap.ui.getCore().byId("sInpQuantity").setValue(parseFloat(e.Cant_Min));this.oDialogQuantity.data("oProduct",e);this.oDialogQuantity.open()},onSelectAlmacenReserva:function(e){u=this.getView().getModel("localmodel").getProperty("/AlternativosItems");var t=e.getParameters().listItem.getBindingContext("localmodel").getObject();d=t;var a=this.getModel("cartProducts");var i=a.getProperty("/cartEntries").find(e=>e.ItemCode===d.ItemCode&&e.WarehouseCode===d.WarehouseCode);if(i){o.warning("El alternativo seleccionado ya existe en la lista de reservas.");this.onLimpiarCabeceraDetalle();return}if(t.InStock!==0){this.onAddToCart()}else{o.warning("Este item no tiene stock")}},onLimpiarCabeceraDetalle:function(){d=null;u=null},onAddQuantity:function(e){var t=this.getModel("cartProducts");if(d&&u){var a=d;var i=u}else{var a=e.getSource().getParent().data("oProduct");var i=this.getView().getModel("localmodel").getData().itemSelected;a.NoexisteSeleccionado=false;this.getView().getModel("localmodel").refresh(true)}var o=sap.ui.getCore().byId("sInpQuantity").getValue()*1;var r=this.getModel("i18n").getResourceBundle();n.addToCart(r,a,t,o,i,this.getView().getModel("localmodel"));this.cantidad_productos=t.getProperty("/cartEntries").length;this.getView().getModel("localmodel").setProperty("/listaProductosCantidad/value",this.cantidad_productos);this.onLimpiarCabeceraDetalle();this.onCancelQuantity()},onChangeQuantity:function(e){var t=e.getSource();var a=e.getParameter("value");var i=t.getMin();if(d){var n=d.InStock}else{var n=this.getView().getModel("localmodel").getProperty("/ProductData").InStock}if(a>n){t.setValue(n);o.warning("La cantidad excede la cantidad de stock.")}if(a<i){o.warning("La cantidad mínima permitida es "+t.getMin()+".");t.setValue(i);var r=t.getBinding("value");if(r){setTimeout(function(){r.setValue(i)},1e3)}}},onChangeQuantityCart:function(e){var t=e.getSource();var a=e.getParameter("value");var i=t.getMin();var n=e.getSource().getBindingContext("cartProducts").getObject().InStock;if(a>n){t.setValue(n);o.warning("La cantidad excede la cantidad de stock.")}if(a<i){o.warning("La cantidad mínima permitida es "+t.getMin()+".");t.setValue(i);var r=t.getBinding("value");if(r){setTimeout(function(){r.setValue(i)},1e3)}}},onCancelQuantity:function(e){if(this.oDialogQuantity){this.oDialogQuantity.close();this.oDialogQuantity.destroy();this.oDialogQuantity=null}this.onLimpiarCabeceraDetalle()},_clearComparison:function(){var e=this.getOwnerComponent().getModel("comparison");e.setData({category:"",item1:"",item2:""})},handleSuggest:function(e){var t=e.getSource();var a=t.getBindingInfo("suggestionItems").template;var i=[];var n=e.getParameter("suggestValue");if(n){i.push(new r(a.getBindingPath("text"),s.Contains,n));i.push(new r(a.getBindingPath("additionalText"),s.Contains,n))}e.getSource().getBinding("suggestionItems").filter(new r({filters:i,and:false}));e.getSource().setFilterSuggests(false)}})});