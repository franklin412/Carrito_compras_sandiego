sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/Device","../model/formatter","sap/m/MessageBox","../service/serviceSL"],function(t,e,r,o,a,i){"use strict";var s="cartProducts";var n="savedForLaterEntries";var c="cartEntries";return t.extend("zsandiego.crearreserva.controller.Cart",{formatter:o,onInit:function(){this._oRouter=this.getRouter();this._oRouter.getRoute("cart").attachPatternMatched(this._routePatternMatched,this);this._oRouter.getRoute("productCart").attachPatternMatched(this._routePatternMatched,this);this._oRouter.getRoute("comparisonCart").attachPatternMatched(this._routePatternMatched,this);var t=new e({});this.getView().setModel(t,"cfg");this._toggleCfgModel();var r=this.byId("editButton");r.addEventDelegate({onAfterRendering:function(){r.focus()}})},onExit:function(){if(this._orderDialog){this._orderDialog.destroy()}if(this._orderBusyDialog){this._orderBusyDialog.destroy()}},_routePatternMatched:function(){this._setLayout("Three");var t=this.getModel("cartProducts");var e=t.getProperty("/cartEntries");if(e.length>0){t.setProperty("/showProceedButton",true);t.setProperty("/showEditButton",true)}var r=this.byId("entryList");r.removeSelections()},onEditOrDoneButtonPress:function(){this._toggleCfgModel()},_toggleCfgModel:function(){let t=false;var e=this.getView().getModel("cfg");var o=this.getOwnerComponent().getModel("cartProducts");o.getData().cartEntries.forEach(function(e){parseFloat(e.Quantity)===0?t=true:null});if(t){a.warning("Las cantidades registradas en las solicitudes deben ser mayores a 0.");return}var i=e.getData();var s=this.getResourceBundle();var n=!i.hasOwnProperty("inDelete");var c=n?true:i.inDelete;var d=r.system.phone?"None":"SingleSelectMaster";var u=r.system.phone?"Active":"Inactive";e.setData({inDelete:!c,notInDelete:c,listMode:c?d:"Delete",listItemType:c?u:"Inactive",pageTitle:c?s.getText("appTitle"):s.getText("cartTitleEdit")});o.refresh(true)},onEntryListPress:function(t){this._showProduct(t.getSource())},onEntryListSelect:function(t){this._showProduct(t.getParameter("listItem"))},onSaveForLater:function(t){var e=t.getSource().getBindingContext(s);this._changeList(n,c,e)},onAddBackToBasket:function(t){var e=t.getSource().getBindingContext(s);this._changeList(c,n,e)},_changeList:function(t,e,r){var o=r.getModel();var a=r.getObject();var i=o.getData();var s=Object.assign({},i[t]);var n=Object.assign({},i[e]);var c=a.Item;if(s[c]===undefined){s[c]=Object.assign({},a)}delete n[c];o.setProperty("/"+t,s);o.setProperty("/"+e,n)},_showProduct:function(t){var e=t.getBindingContext(s).getObject();var o=false;if(!r.system.phone){o=this.getModel("appView").getProperty("/layout").startsWith("Three")}else{o=false;this._setLayout("Two")}this._oRouter.navTo(o?"productCart":"product",{id:e.Category,productId:e.ProductId},!r.system.phone)},onCartEntriesDelete:function(t){this._deleteProduct(c,t)},onSaveForLaterDelete:function(t){this._deleteProduct(n,t)},_deleteProduct:function(t,e){var r=e.getParameter("listItem").getBindingContext(s);var o=r.getObject().Item;var i=this.getResourceBundle();a.show(i.getText("cartDeleteDialogMsg"),{title:i.getText("cartDeleteDialogTitle"),actions:[a.Action.DELETE,a.Action.CANCEL],onClose:function(e){if(e!==a.Action.DELETE){return}var i=r.getModel();var s=Object.assign({},i.getData()[t]);delete s[o];i.setProperty("/"+t,Object.assign({},s))}})},onProceedButtonPress:async function(){try{sap.ui.core.BusyIndicator.show(0);var t=this.getModel("cartProducts");var e=t.getProperty("/cartEntries").length;this.getView().getModel("localmodel").setProperty("/listaProductosCantidad/value",e);this.getRouter().navTo("checkout");sap.ui.core.BusyIndicator.hide()}catch(t){a.warning("Error al cargar los datos maestros");sap.ui.core.BusyIndicator.hide()}},consultaActivoFijoWizard:async function(){var t=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this.getView()))._oManifest._oBaseUri._parts.path;var e=await i.consultaGeneralB1SL(t,"/Items?$filter=ItemType eq 'itFixedAssets' and Valid eq 'tYES'");this.getView().getModel("localmodel").setProperty("/ActivoFijo",e.value)}})});