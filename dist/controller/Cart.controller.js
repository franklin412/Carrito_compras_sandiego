sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/Device","../model/formatter","sap/m/MessageBox","../service/serviceSL"],function(t,e,o,r,a,i){"use strict";var s="cartProducts";var n="savedForLaterEntries";var c="cartEntries";return t.extend("zsandiego.crearreserva.controller.Cart",{formatter:r,onInit:function(){this._oRouter=this.getRouter();this._oRouter.getRoute("cart").attachPatternMatched(this._routePatternMatched,this);this._oRouter.getRoute("productCart").attachPatternMatched(this._routePatternMatched,this);this._oRouter.getRoute("comparisonCart").attachPatternMatched(this._routePatternMatched,this);var t=new e({});this.getView().setModel(t,"cfg");this._toggleCfgModel();var o=this.byId("editButton");o.addEventDelegate({onAfterRendering:function(){o.focus()}})},onExit:function(){if(this._orderDialog){this._orderDialog.destroy()}if(this._orderBusyDialog){this._orderBusyDialog.destroy()}},_routePatternMatched:function(){this._setLayout("Three");var t=this.getModel("cartProducts");var e=t.getProperty("/cartEntries");if(e.length>0){t.setProperty("/showProceedButton",true);t.setProperty("/showEditButton",true)}var o=this.byId("entryList");o.removeSelections()},onEditOrDoneButtonPress:function(){this._toggleCfgModel()},_toggleCfgModel:function(){var t=this.getView().getModel("cfg");var e=t.getData();var r=this.getResourceBundle();var a=!e.hasOwnProperty("inDelete");var i=a?true:e.inDelete;var s=o.system.phone?"None":"SingleSelectMaster";var n=o.system.phone?"Active":"Inactive";t.setData({inDelete:!i,notInDelete:i,listMode:i?s:"Delete",listItemType:i?n:"Inactive",pageTitle:i?r.getText("appTitle"):r.getText("cartTitleEdit")});var c=this.getOwnerComponent().getModel("cartProducts");c.refresh(true)},onEntryListPress:function(t){this._showProduct(t.getSource())},onEntryListSelect:function(t){this._showProduct(t.getParameter("listItem"))},onSaveForLater:function(t){var e=t.getSource().getBindingContext(s);this._changeList(n,c,e)},onAddBackToBasket:function(t){var e=t.getSource().getBindingContext(s);this._changeList(c,n,e)},_changeList:function(t,e,o){var r=o.getModel();var a=o.getObject();var i=r.getData();var s=Object.assign({},i[t]);var n=Object.assign({},i[e]);var c=a.Item;if(s[c]===undefined){s[c]=Object.assign({},a)}delete n[c];r.setProperty("/"+t,s);r.setProperty("/"+e,n)},_showProduct:function(t){var e=t.getBindingContext(s).getObject();var r=false;if(!o.system.phone){r=this.getModel("appView").getProperty("/layout").startsWith("Three")}else{r=false;this._setLayout("Two")}this._oRouter.navTo(r?"productCart":"product",{id:e.Category,productId:e.ProductId},!o.system.phone)},onCartEntriesDelete:function(t){this._deleteProduct(c,t)},onSaveForLaterDelete:function(t){this._deleteProduct(n,t)},_deleteProduct:function(t,e){var o=e.getParameter("listItem").getBindingContext(s);var r=o.getObject().Item;var i=this.getResourceBundle();a.show(i.getText("cartDeleteDialogMsg"),{title:i.getText("cartDeleteDialogTitle"),actions:[a.Action.DELETE,a.Action.CANCEL],onClose:function(e){if(e!==a.Action.DELETE){return}var i=o.getModel();var s=Object.assign({},i.getData()[t]);delete s[r];i.setProperty("/"+t,Object.assign({},s))}})},onProceedButtonPress:async function(){try{sap.ui.core.BusyIndicator.show(0);var t=this.getModel("cartProducts");await this.consultaActivoFijoWizard();var e=t.getProperty("/cartEntries").length;this.getView().getModel("localmodel").setProperty("/listaProductosCantidad/value",e);this.getRouter().navTo("checkout");sap.ui.core.BusyIndicator.hide()}catch(t){a.warning("Error al cargar los datos maestros");sap.ui.core.BusyIndicator.hide()}},consultaActivoFijoWizard:async function(){var t=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this.getView()))._oManifest._oBaseUri._parts.path;var e=await i.onConsultaServiceLayer(t,"Items?$filter=ItemType eq 'itFixedAssets' and Valid eq 'tYES'");this.getView().getModel("localmodel").setProperty("/ActivoFijo",e)}})});