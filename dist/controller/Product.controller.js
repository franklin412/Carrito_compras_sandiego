sap.ui.define(["./BaseController","../model/formatter","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/ui/core/BusyIndicator","../model/cart","../service/serviceSL"],function(e,t,a,r,o,i,n,l,s,d){"use strict";return e.extend("zsandiego.crearreserva.controller.Product",{formatter:t,onInit:function(){var e=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this.getView()))._oManifest._oBaseUri._parts.path;var t=new n({Url_Imagen:e+"img/almacen02.png",welcomeCarouselSlider2:"zsandiego/crearreserva/img/slider2.png",Promoted:[],Viewed:[],Favorite:[],Currency:"USD"});this.getView().setModel(t,"productImagen");var a=this.getOwnerComponent();this._router=a.getRouter();this._router.getRoute("product").attachPatternMatched(this._routePatternMatched,this);this._router.getTarget("product").attachDisplay(function(e){},this);this.ProductcomprasSPOT=sap.ui.xmlfragment("zsandiego.crearreserva.view.fragment.ProductComprasSPOT",this);this.getView().addDependent(this.ProductcomprasSPOT)},onAvatarPress:function(){const e=this.getOwnerComponent().getEventBus();e.publish("app","openDatosCabecera",{})},_routePatternMatched:function(e){var t=e.getParameter("arguments").productId,a=e.getParameter("arguments").productType,r=e.getParameter("arguments").id,o=this.getView(),i=o.getModel("catalogo");var n=this},fnUpdateProduct:function(e,t,a){var r="localmodel>/"+this.getView().getModel("localmodel").createKey("materialesSet",{Item:e,Catyp:t,Catnr:a});var o=function(){this._checkIfProductAvailable(r)};this.getView().bindElement({path:r,events:{change:o.bind(this)}})},_checkIfProductAvailable:function(e){var t=this.getModel("localmodel");var a=t.getData(e.replace("localmodel>",""));if(!a){this._router.getTargets().display("notFound")}},onToggleCart:function(e){var t=e.getParameter("pressed");var a=this.getView().getModel("localmodel").getProperty("/ProductData");this._setLayout(t?"Three":"Two");this.getRouter().navTo(t?"productCart":"product",{id:a.ItemCode,productType:a.WarehouseCode,productId:a.InStock})},onGetAlternativo:async function(e){l.show();var t=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this.getView()))._oManifest._oBaseUri._parts.path;var a=e.getSource().getBindingContext("localmodel").getObject();this.getView().getModel("localmodel").setProperty("/AlternativoSeleccionado",a);var r=await d.onObtenerAlternativosDetalle(a.AlternativeItemCode,t);if(r){for(let e=0;e<r.ItemWarehouseInfoCollection.length;e++){var o=r.ItemWarehouseInfoCollection[e];if(o.InStock>0){var i=await d.onObtenerDescuentoReserva(t,o);i.length>0?o.InStock=o.InStock2-i[0].U_CantReserva:null}}this.getView().getModel("localmodel").setProperty("/AlternativosItems",r);this.getView().getModel("localmodel").refresh(true);this.onOpenAlternativo()}l.hide()},onOpenAlternativo:function(e){var t=this;if(!t._valueHelpDialogAlternativo){t._valueHelpDialogAlternativo=sap.ui.xmlfragment("zsandiego.crearreserva.view.fragment.Alternativo",t);t.getView().addDependent(t._valueHelpDialogAlternativo)}t._valueHelpDialogAlternativo.open()},pressOutAlternativo:function(){this._valueHelpDialogAlternativo.close()},pressComprasSpot:function(){this.ProductcomprasSPOT.open()},onRegistrarCompraSPOT:function(e){var t=!!this.getView().$().closest(".sapUiSizeCompact").length;var a=this.getModel("i18n").getResourceBundle();var r=sap.ui.getCore().byId("idComprasProv_").getValue();var o=sap.ui.getCore().byId("idGrupoArticulo_").getValue();var i=sap.ui.getCore().byId("idNombreMaterial_").getValue();var n=sap.ui.getCore().byId("idCantidadSPOT_").getValue();var l=sap.ui.getCore().byId("idUnidadMedida_").getValue();var s=sap.ui.getCore().byId("idPrecio_").getValue();var d=this.getModel("cartProducts");var u=d.getProperty("/cartEntries").length;this.getView().getModel("localmodel").setProperty("/listaProductosCantidad/value",u);var g=u+1;var c={SupplierName:"Compras SPOT",Detalle:{},GrupoArticulo:o,highlight:"Warning",Status:"A",ProductId:g,CurrencyCode:"USD",Name:i,Price:s,Quantity:n,Unit:l};this.addToCart(a,c,d);this.ProductcomprasSPOT.close();this.limpiarComprasSPOT()},addToCart:function(e,t,a){this._updateCartItem(e,t,a)},_updateCartItem:function(e,t,r){var o=sap.ui.getCore().byId("idCantidadSPOT_").getValue();var i=Object.assign([],r.getData()["cartEntries"]);var n=i[t.ProductId];if(n===undefined){n=Object.assign({},t);n.Quantity=o;i[t.ProductId]=n}else{n.Quantity=o}r.refresh(true);a.show(e.getText("productMsgAddedToCart",[t.Name]))},limpiarComprasSPOT:function(){sap.ui.getCore().byId("idGrupoArticulo_").setValue();sap.ui.getCore().byId("idUnidadMedida_").setValue();sap.ui.getCore().byId("idComprasProv_").setValue();sap.ui.getCore().byId("idNombreMaterial_").setValue();sap.ui.getCore().byId("idCantidadSPOT_").setValue();sap.ui.getCore().byId("idPrecio_").setValue()},onSalirComprasSPOT:function(){this.ProductcomprasSPOT.close();this.limpiarComprasSPOT()},openFragProveedor:function(e){var t=e.getSource().getValue();var a=this;a.inputId="idComprasProv_";if(!a._valueHelpDialog){a._valueHelpDialog=sap.ui.xmlfragment("zsandiego.crearreserva.view.fragment.ProveedorSPOT.WelcomeComprasSPOT",a);a.getView().addDependent(a._valueHelpDialog)}a._valueHelpDialog.getBinding("items").filter([new o("descripcionProv",i.Contains,t)]);a._valueHelpDialog.open(t)},_handleValueHelpSearchProveedor:function(e){var t=e.getParameter("value");var a=new o("descripcionProv",i.Contains,t);e.getSource().getBinding("items").filter([a])},_handleValueHelpCloseProv:function(e){var t=e.getParameter("selectedItem");if(t){var a=sap.ui.getCore().byId("idComprasProv_");a.setValue(t.getTitle())}e.getSource().getBinding("items").filter([])},openFragUM:function(e){var t=e.getSource().getValue();var a=this;a.inputId="idUnidadMedida_";if(!a._valueHelpDialogUMProduct){a._valueHelpDialogUMProduct=sap.ui.xmlfragment("zsandiego.crearreserva.view.fragment.UnidadMedida.ProductUM",a);a.getView().addDependent(a._valueHelpDialogUMProduct)}a._valueHelpDialogUMProduct.getBinding("items").filter([new o("unidad",i.Contains,t)]);a._valueHelpDialogUMProduct.open(t)},_handleValueHelpSearchUM:function(e){var t=e.getParameter("value");var a=new o("unidad",i.Contains,t);e.getSource().getBinding("items").filter([a])},_handleValueHelpCloseUM:function(e){var t=e.getParameter("selectedItem");if(t){var a=sap.ui.getCore().byId("idUnidadMedida_");a.setValue(t.getTitle())}e.getSource().getBinding("items").filter([])},openFragGA:function(e){var t=e.getSource().getValue();var a=this;a.inputId="idGrupoArticulo_";if(!a._valueHelpDialogGArt){a._valueHelpDialogGArt=sap.ui.xmlfragment("zsandiego.crearreserva.view.fragment.GrupoArticulo.ProductGrupoArt",a);a.getView().addDependent(a._valueHelpDialogGArt)}a._valueHelpDialogGArt.getBinding("items").filter([new o("grupoArticulotext",i.Contains,t)]);a._valueHelpDialogGArt.open(t)},_handleValueHelpSearchGA:function(e){var t=e.getParameter("value");var a=new o("grupoArticulotext",i.Contains,t);e.getSource().getBinding("items").filter([a])},_handleValueHelpCloseGA:function(e){var t=e.getParameter("selectedItem");if(t){var a=sap.ui.getCore().byId("idGrupoArticulo_");a.setValue(t.getTitle())}e.getSource().getBinding("items").filter([])}})});