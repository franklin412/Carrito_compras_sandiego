sap.ui.define(["./BaseController","../model/formatter","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel"],function(e,t,a,r,i,o,n){"use strict";return e.extend("zsandiego.carritocompras.controller.Product",{formatter:t,onInit:function(){var e=new n({Url_Imagen:"img/almacen02.png",welcomeCarouselSlider2:"zsandiego/carritocompras/img/slider2.png",Promoted:[],Viewed:[],Favorite:[],Currency:"USD"});this.getView().setModel(e,"productImagen");var t=this.getOwnerComponent();this._router=t.getRouter();this._router.getRoute("product").attachPatternMatched(this._routePatternMatched,this);this._router.getTarget("product").attachDisplay(function(e){},this);this.ProductcomprasSPOT=sap.ui.xmlfragment("zsandiego.carritocompras.view.fragment.ProductComprasSPOT",this);this.getView().addDependent(this.ProductcomprasSPOT)},onAvatarPress:function(){const e=this.getOwnerComponent().getEventBus();e.publish("app","openDatosCabecera",{})},_routePatternMatched:function(e){var t=e.getParameter("arguments").productId,a=e.getParameter("arguments").productType,r=e.getParameter("arguments").id,i=this.getView(),o=i.getModel("catalogo");var n=this},fnUpdateProduct:function(e,t,a){var r="localmodel>/"+this.getView().getModel("localmodel").createKey("materialesSet",{Item:e,Catyp:t,Catnr:a});var i=function(){this._checkIfProductAvailable(r)};this.getView().bindElement({path:r,events:{change:i.bind(this)}})},_checkIfProductAvailable:function(e){var t=this.getModel("localmodel");var a=t.getData(e.replace("localmodel>",""));if(!a){this._router.getTargets().display("notFound")}},onToggleCart:function(e){var t=e.getParameter("pressed");var a=this.getView().getModel("localmodel").getProperty("/ProductData");this._setLayout(t?"Three":"Two");this.getRouter().navTo(t?"productCart":"product",{id:a.ItemCode,productType:a.WarehouseCode,productId:a.InStock})},pressComprasSpot:function(){this.ProductcomprasSPOT.open()},onRegistrarCompraSPOT:function(e){var t=!!this.getView().$().closest(".sapUiSizeCompact").length;var a=this.getModel("i18n").getResourceBundle();var i=sap.ui.getCore().byId("idComprasProv_").getValue();var o=sap.ui.getCore().byId("idGrupoArticulo_").getValue();var n=sap.ui.getCore().byId("idNombreMaterial_").getValue();var l=sap.ui.getCore().byId("idCantidadSPOT_").getValue();var s=sap.ui.getCore().byId("idUnidadMedida_").getValue();var d=sap.ui.getCore().byId("idPrecio_").getValue();if(i.length===0){r.warning("Seleccione un proveedor",{styleClass:t?"sapUiSizeCompact":""});return}else if(o.length===0){r.warning("Seleccione un grupo de art√≠culo",{styleClass:t?"sapUiSizeCompact":""});return}else if(n.length===0){r.warning("Ingrese el nombre de material",{styleClass:t?"sapUiSizeCompact":""});return}else if(l.length===0){r.warning("Ingrese la cantidad del material",{styleClass:t?"sapUiSizeCompact":""});return}else if(l==0){r.warning("Ingresa una cantidad diferente a 0",{styleClass:t?"sapUiSizeCompact":""});sap.ui.getCore().byId("idCantidadSPOT_").setValue();return}else if(s.length===0){r.warning("Ingrese la unidad de medida",{styleClass:t?"sapUiSizeCompact":""});return}else if(d.length===0){r.warning("Ingrese el precio unitario del material",{styleClass:t?"sapUiSizeCompact":""});return}else if(d==0){r.warning("Ingresa un precio unitario diferente a 0",{styleClass:t?"sapUiSizeCompact":""});sap.ui.getCore().byId("idPrecio_").setValue();return}var u=this.getModel("cartProducts");var g=Object.keys(u.getProperty("/cartEntries")).length;this.getView().getModel("localmodel").setProperty("/listaProductosCantidad/value",g);var c=g+1;var p={SupplierName:"Compras SPOT",Detalle:{},GrupoArticulo:o,highlight:"Warning",Status:"A",ProductId:c,CurrencyCode:"USD",Name:n,Price:d,Quantity:l,Unit:s};this.addToCart(a,p,u);this.ProductcomprasSPOT.close();this.limpiarComprasSPOT()},addToCart:function(e,t,a){this._updateCartItem(e,t,a)},_updateCartItem:function(e,t,r){var i=sap.ui.getCore().byId("idCantidadSPOT_").getValue();var o=Object.assign({},r.getData()["cartEntries"]);var n=o[t.ProductId];if(n===undefined){n=Object.assign({},t);n.Quantity=i;o[t.ProductId]=n}else{n.Quantity=i}r.setProperty("/cartEntries",Object.assign({},o));r.refresh(true);a.show(e.getText("productMsgAddedToCart",[t.Name]))},limpiarComprasSPOT:function(){sap.ui.getCore().byId("idGrupoArticulo_").setValue();sap.ui.getCore().byId("idUnidadMedida_").setValue();sap.ui.getCore().byId("idComprasProv_").setValue();sap.ui.getCore().byId("idNombreMaterial_").setValue();sap.ui.getCore().byId("idCantidadSPOT_").setValue();sap.ui.getCore().byId("idPrecio_").setValue()},onSalirComprasSPOT:function(){this.ProductcomprasSPOT.close();this.limpiarComprasSPOT()},openFragProveedor:function(e){var t=e.getSource().getValue();var a=this;a.inputId="idComprasProv_";if(!a._valueHelpDialog){a._valueHelpDialog=sap.ui.xmlfragment("zsandiego.carritocompras.view.fragment.ProveedorSPOT.WelcomeComprasSPOT",a);a.getView().addDependent(a._valueHelpDialog)}a._valueHelpDialog.getBinding("items").filter([new i("descripcionProv",o.Contains,t)]);a._valueHelpDialog.open(t)},_handleValueHelpSearchProveedor:function(e){var t=e.getParameter("value");var a=new i("descripcionProv",o.Contains,t);e.getSource().getBinding("items").filter([a])},_handleValueHelpCloseProv:function(e){var t=e.getParameter("selectedItem");if(t){var a=sap.ui.getCore().byId("idComprasProv_");a.setValue(t.getTitle())}e.getSource().getBinding("items").filter([])},openFragUM:function(e){var t=e.getSource().getValue();var a=this;a.inputId="idUnidadMedida_";if(!a._valueHelpDialogUMProduct){a._valueHelpDialogUMProduct=sap.ui.xmlfragment("zsandiego.carritocompras.view.fragment.UnidadMedida.ProductUM",a);a.getView().addDependent(a._valueHelpDialogUMProduct)}a._valueHelpDialogUMProduct.getBinding("items").filter([new i("unidad",o.Contains,t)]);a._valueHelpDialogUMProduct.open(t)},_handleValueHelpSearchUM:function(e){var t=e.getParameter("value");var a=new i("unidad",o.Contains,t);e.getSource().getBinding("items").filter([a])},_handleValueHelpCloseUM:function(e){var t=e.getParameter("selectedItem");if(t){var a=sap.ui.getCore().byId("idUnidadMedida_");a.setValue(t.getTitle())}e.getSource().getBinding("items").filter([])},openFragGA:function(e){var t=e.getSource().getValue();var a=this;a.inputId="idGrupoArticulo_";if(!a._valueHelpDialogGArt){a._valueHelpDialogGArt=sap.ui.xmlfragment("zsandiego.carritocompras.view.fragment.GrupoArticulo.ProductGrupoArt",a);a.getView().addDependent(a._valueHelpDialogGArt)}a._valueHelpDialogGArt.getBinding("items").filter([new i("grupoArticulotext",o.Contains,t)]);a._valueHelpDialogGArt.open(t)},_handleValueHelpSearchGA:function(e){var t=e.getParameter("value");var a=new i("grupoArticulotext",o.Contains,t);e.getSource().getBinding("items").filter([a])},_handleValueHelpCloseGA:function(e){var t=e.getParameter("selectedItem");if(t){var a=sap.ui.getCore().byId("idGrupoArticulo_");a.setValue(t.getTitle())}e.getSource().getBinding("items").filter([])}})});