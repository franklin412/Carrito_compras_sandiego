sap.ui.define(["sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,n,t,r){"use strict";var o;return{setManifestObject:function(e){o=e.getOwnerComponent().getManifestObject()},onAprobarServiceLayer:function(e,n){return new Promise(function(t,r){var o=n+"sb1sl/DraftsService_SaveDraftToDocument";var s={Document:{DocDueDate:e.contextData.FechaRegistro,DocEntry:e.contextData.DocEntry}};$.ajax({type:"POST",dataType:"json",url:o,data:JSON.stringify(s),success:function(e){t(e)},error:function(e){r(e)}})})},onAprobarServiceLayertask:function(e,n,t,r,o,s){return new Promise(function(t,r){var a=n+"sb1sl/Drafts("+e.contextData.DocEntry+")";var i={};i.ESTADO_RESERVA=s;if(s=="RESERVADO"||s=="POR ENTREGAR"){i.U_ESTADO_A1="A";i.U_ESTADO_A2="P";i.U_APROBADOR1=571;i.U_COMENTARIO_A1=o?o:"Aprobado nivel 1 - 2"}else{i.U_ESTADO_A2="A";i.U_APROBADOR2=488;i.U_COMENTARIO_A2=o?o:"Aprobado nivel 3"}$.ajax({type:"PATCH",dataType:"json",url:a,data:JSON.stringify(i),success:function(e){t(e)},error:function(e){r(e)}})})},onRechazarServiceLayertask:function(e,n,t,r){return new Promise(function(r,o){var s=n+"sb1sl/Drafts("+e.contextData.DocEntry+")";var a={};a.ESTADO_RESERVA="CANCELADO";if(t){a.U_ESTADO_A1="R";a.U_APROBADOR1=571;a.U_COMENTARIO_A1="Rechazado nivel 1 - 2"}else{a.U_ESTADO_A2="R";a.U_APROBADOR2=488;a.U_COMENTARIO_A2="Rechazado nivel 3"}$.ajax({type:"PATCH",dataType:"json",url:s,data:JSON.stringify(a),success:function(e){r(e)},error:function(e){o(e)}})})},onRechazarServiceLayer:function(e,n){return new Promise(function(t,r){var o=n+"sb1sl/Drafts("+e.contextData.DocEntry+")/Cancel";$.ajax({type:"POST",dataType:"json",url:o,success:function(e){t(e)},error:function(e){r(e)}})})},onAprobarWFInstance:function(e,n,t,r){var o={estadoAprob:true};if(t){o.AprobadorWF1=r}else{o.AprobadorWF2=r}return new Promise(function(t,r){$.ajax({url:n+"/wfrest/v1/task-instances/"+e.id,method:"PATCH",contentType:"application/json",dataType:"json",data:'{"status": "COMPLETED", "context": '+JSON.stringify(o)+"}",headers:{"X-CSRF-Token":"Fetch"},success:function(e){t(e)},error:function(e){r(e)}})})},onRechazarWFInstance:function(e,n,t,r){var o={};if(t){o.AprobadorWF1=r}else{o.AprobadorWF2=r}return new Promise(function(t,r){$.ajax({url:n+"/wfrest/v1/workflow-instances/"+e.workflowInstanceId,method:"PATCH",contentType:"application/json",async:false,data:'{"status": "CANCELED", "context": '+JSON.stringify(o)+"}",headers:{"X-CSRF-Token":"Fetch"},success:function(e){t(e)},error:function(e){r(e)}})})},onGetWorkflowInstances:function(e,n,t){var r=this,o,s=0;o="";return new Promise(function(t,a){$.ajax({url:n+"/wfrest/v1/task-instances?$skip=0&$top=1000&$inlinecount=allpages&status=READY,CANCELED,COMPLETED"+o+"&workflowDefinitionId=workflowmodulev1.myworkflowapproval",method:"GET",async:false,headers:{"X-CSRF-Token":"Fetch"},success:function(t,o,a){t.forEach(function(e){e.fechaOrder=new Date(e.createdAt).getTime();if(e.status==="READY"){e.estadoTarea="Pendiente";e.visible=true;e.orden=1}else if(e.status==="COMPLETED"){e.estadoTarea="Aprobado";e.visible=false;e.orden=2}else{e.estadoTarea="Rechazado";e.visible=false;e.orden=3}});t.sort(function(e,n){return n.fechaOrder-e.fechaOrder});t.forEach(function(t){s++;if(s<=20){r.getInstancesContext(t,e,n)}else{e.localModel.getProperty("/workflowitems").push(t);e.localModel.refresh(true)}})}})})},getInstancesContext:function(e,n,t){return new Promise(function(r,o){$.ajax({url:t+"/wfrest/v1/workflow-instances/"+e.workflowInstanceId+"/context",method:"GET",async:false,headers:{"X-CSRF-Token":"Fetch"},success:function(t,o,s){if(t.FechaRegistro){var a=t.FechaRegistro.split("-");e.FechaRegistroFilter=new Date(a[2]+"-"+a[1]+"-"+a[0])}t.AprobadorWF2?t.AprobadorWorkflow=t.AprobadorWF2:t.AprobadorWorkflow=t.AprobadorWF1;e.contextData=t;n.localModel.getProperty("/workflowitems").push(e);n.localModel.refresh(true);r(t)}})})},onGetCantidadCorrelativo:function(e,n){return new Promise(function(e,t){var r=n+"sb1sl/RESERVAS_BTP/$count";$.ajax({type:"GET",dataType:"json",url:r,success:function(n){e(n)},error:function(e){t(e)}})})},onAddDescuento:function(e,n){return new Promise(function(t,r){var o=n+"sb1sl/RESERVAS_BTP";var s={Code:e.Code,U_ItemCode:e.ItemCode,U_WhsCode:e.WarehouseCode,U_CantReserva:e.Quantity};$.ajax({type:"POST",dataType:"json",url:o,data:JSON.stringify(s),success:function(e){t(e)},error:function(e){r(e)}})})},onObtenerDescuentoReserva:function(e,n){return new Promise(function(t,r){var o=e+"sb1sl/RESERVAS_BTP?$filter=U_ItemCode eq '"+n.ItemCode+"' and U_WhsCode eq '"+n.WarehouseCode+"'";$.ajax({type:"GET",dataType:"json",url:o,success:function(e){t(e.value)},error:function(e){r(e)}})})},onEditDescuento:function(e,n){var t={U_ItemCode:n.U_ItemCode,U_WhsCode:n.U_WhsCode,U_CantReserva:n.U_CantReserva};return new Promise(function(r,o){var s=e+"sb1sl/RESERVAS_BTP('"+n.Code+"')";$.ajax({type:"PATCH",dataType:"json",url:s,data:JSON.stringify(t),success:function(e){r(e.value)},error:function(e){o(e)}})})},onObtenerAlternativosDetalle:function(e,n){var t=this;return new Promise(function(t,r){var o=n+"sb1sl/Items('"+e+"')";$.ajax({type:"GET",dataType:"json",url:o,success:function(e){e.ItemWarehouseInfoCollection.forEach(function(e){e.InStock2=e.InStock});t(e)},error:function(e){r(e.responseJSON)}})})},onConsultaServiceLayer:function(e,n){var t=this;return new Promise(function(t,r){var o=e+"sb1sl/"+n;$.ajax({type:"GET",dataType:"json",url:o,success:function(e){t(e.value)},error:function(e){r(e.responseJSON)}})})},onConsultaServiceLayerIdentificador:function(e,n,t){var r=this;return new Promise(function(n,r){var o=e+"sb1sl/U_ACTIVOS?$filter=U_Solicitante eq '"+t+"'";$.ajax({type:"GET",dataType:"json",url:o,success:function(e){n(e.value)},error:function(e){r(e.responseJSON)}})})},onConsultaIAS:function(e,n,t){var r=this,o;if(t==="Group"){o="groups.display";e="Grp_Aprobar_Reserva"}else{o="emails.value"}return new Promise(function(t,r){var s=n+"iasscim/Users?filter="+o+' eq "'+e+'"';$.ajax({type:"GET",contentType:"application/scim+json",url:s,success:function(e){t(e)},error:function(e){r(e.responseJSON)}})})},onObtenerAreas:function(e,n){return new Promise(function(t,r){var o=e+"sb1sl/Area('"+n+"')";$.ajax({type:"GET",dataType:"json",url:o,success:function(e){t(e)},error:function(e){r(e.responseJSON)}})})},getCentrosCosto:function(e,n){var t=this;return new Promise(function(t,r){var o=e+"sb1sl/ProfitCenters?$filter= U_Area eq '"+n+"'";$.ajax({type:"GET",dataType:"json",url:o,success:function(e){t(e.value)},error:function(e){t(e)}})})},consultaEmpleado:function(e,n,t,r){var o=this,s;!r?r=0:null;return new Promise(function(o,a){t==="S"?s="ExternalEmployeeNumber":s="U_Area";var i=n+"sb1sl/EmployeesInfo?$filter="+s+" eq '"+e+"'&$skip="+r;$.ajax({type:"GET",dataType:"json",url:i,success:function(e){o(e.value)},error:function(e){a(e.responseJSON)}})})},consultaProjects:function(e,n){var t=this,r;var o=n.getUTCFullYear()+"-"+(n.getUTCMonth()+1).toString().padStart(2,"0")+"-"+n.getDate().toString().padStart(2,"0");return new Promise(function(n,t){var r=e+"sb1sl/Projects?$filter=ValidFrom lt '"+o+"' and ValidTo gt '"+o+"'";$.ajax({type:"GET",dataType:"json",url:r,success:function(e){n(e.value)},error:function(e){t(e.responseJSON)}})})},onObtenerAlmacen:function(e,n){var t=this,r;return new Promise(function(t,r){var o=n+"sb1sl/Warehouses('"+e+"')";$.ajax({type:"GET",dataType:"json",url:o,success:function(e){t(e)},error:function(e){r(e.responseJSON)}})})},onObtenerUserxAlmacen:function(e,n){var t=this,r;return new Promise(function(t,r){var o=n+"sb1sl/BTP_ALMXTIPO?$filter=U_WhsCode eq '"+e+"'";$.ajax({type:"GET",dataType:"json",url:o,success:function(e){t(e.value)},error:function(e){r(e.responseJSON)}})})},onObtenerUsersIASxTipo:function(e,n){var t=this;return new Promise(function(e,t){var r=n+"iasscim/Users";$.ajax({type:"GET",contentType:"application/scim+json",url:r,success:function(n){e(n)},error:function(e){t(e.responseJSON)}})})}}});